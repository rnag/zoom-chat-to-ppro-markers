"use strict";addStringMethods();var project=app.project,sequence=project.activeSequence;sequence||exitErr("Script requires an active sequence!");var sequenceMarkers=sequence.markers,rootProject=project.rootItem,item=rootProject.children[0],sep=Folder.fs=="Macintosh"?"/":"\\",folderPath=getFolderName(item);folderPath||exitErr("Script requires a clip in the active sequence!");var clipFolder=Folder(folderPath),colors={GREEN:0,RED:1,PURPLE:2,ORANGE:3,YELLOW:4,WHITE:5,BLUE:6,CYAN:7};function main(){var r=clipFolder.getFiles("*.chat"),t=r.length;t||exitErr("["+folderPath+"] No *.chat file found in media path!");for(var e=0;e<t;e++){var a=r[e];if(a instanceof File&&a.exists){var i=null,n,o;readTextFile(a,function(s){var c=s.split("	"),l=c[0].trim(),f=convertTimecodeToSeconds(l);c.length===3&&f?(i&&createMarker(n,o,i),n=f,o=c[1].trim().slice(0,-1),i=c[2].trim()):i+="\n"+s}),i&&createMarker(n,o,i)}}}function createMarker(r,t,e){var a=sequenceMarkers.createMarker(r),i=e.toLowerCase().split(" ");a.name=t,a.comments=e;for(var n=colors.GREEN,o,s=0;s<i.length;s++)o=i[s],o==="cut"||o==="edit"?n=colors.RED:o==="fix"||o==="replace"?n=colors.ORANGE:o==="audio"||o==="sound"?n=colors.YELLOW:o=="reacted"&&(n=colors.PURPLE);a.setColorByIndex(n)}function exitErr(r){alert(r),exit(-1)}function updateEventPanel(r){app.setSDKEventMessage(r,"info")}function updateWithError(r){app.setSDKEventMessage(r,"error")}function addStringMethods(){typeof String.prototype.trim=="undefined"&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")})}function getFolderName(r){if(!r)return null;var t=r.getMediaPath(),e=t.lastIndexOf(sep);return e>-1?t.slice(0,e):t}function convertTimecodeToSeconds(r){var t=r.split(":");if(t.length!==3)return 0;var e=parseInt(t[0])*3600,a=parseInt(t[1])*60,i=parseInt(t[2]);if(isNaN(e)||isNaN(a)||isNaN(i))return 0;var n=e+a+i;return n}function readTextFile(r,t){var e=r instanceof File?r:new File(r);if(e.exists){e.open("r")||exitErr("Unable to open file "+decodeURI(e.name)),e.encoding||(e.encoding="UTF-8");var a=e.read();e.close();var i=a.split("\n");if(typeof t=="function")for(var n=0;n<i.length;n++)t(i[n],n);return a}else return!1}main();
