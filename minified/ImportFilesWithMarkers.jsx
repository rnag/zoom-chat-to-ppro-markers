"use strict";addStringMethods();var project=app.project,typeClip=ProjectItemType.CLIP,typeFile=ProjectItemType.FILE,sep=Folder.fs=="Macintosh"?"/":"\\",binName="My New Bin",colors={GREEN:0,RED:1,PURPLE:2,ORANGE:3,YELLOW:4,WHITE:5,BLUE:6,CYAN:7},folderToChatFiles={};function main(){var r;importFiles();var n=(r=getPPPInsertionBin())===null||r===void 0?void 0:r.children,e=n.numItems;e===0&&exitErr("Script was unable to create a bin!");for(var t,a,i,o,s,f=0;f<e;f++)if(t=n[f],s=t.name,i=t.type,updateEventPanel("[Checking Bin Item #"+(f+1)+"]"),updateEventPanel("Name: "+s),t.isSequence())updateEventPanel("Skipping Sequence.");else if(i!=typeClip&&i!=typeFile)updateEventPanel("Skipping. Can only add markers to footage items.");else if(a=getFolderName(t),a)if(updateEventPanel("Media Path: "+a),o=t.getMarkers(),o.numMarkers)updateEventPanel("Skipping. Clip already has markers.");else{var p=folderToChatFiles[a];p===void 0&&(p=folderToChatFiles[a]=new Folder(a).getFiles("*.chat"));var u=p.length;if(!u)updateEventPanel("Skipping. No *.chat file(s) found in media path.");else{updateEventPanel("Adding markers.");for(var c=0;c<u;c++){var l=p[c];l instanceof File&&l.exists&&createClipMarkersFromChatFile(o,l)}}}else updateWithError("Unable to determine media path of clip.")}function importFiles(){if(app.project){var r=File.openDialog("Choose files to import","0",!0);if(r){var n=getPPPInsertionBin();if(n){n.select();var e=[];if(e){for(var t=0;t<r.length;t++)e[t]=r[t].fsName;app.project.importFiles(e,!0,n,!1)}}else updateEventPanel("Could not find or create target bin.")}}}function getPPPInsertionBin(){var r=searchForBinWithName(binName);if(r||(app.project.rootItem.createBin(binName),r=searchForBinWithName(binName)),r)return r.select(),r}function searchForBinWithName(r){var n=function(e){if(e&&e.name===r&&e.type===2)return e;for(var t=0;t<e.children.numItems;t++)if(e.children[t]&&e.children[t].type===2){var a=n(e.children[t]);if(a)return a}};return n(app.project.rootItem)}function createClipMarkersFromChatFile(r,n){var e=null,t,a;readTextFile(n,function(i){var o=i.split("	"),s=o[0].trim(),f=convertTimecodeToSeconds(s);o.length===3&&f?(e&&createMarker(r,t,a,e),t=f,a=o[1].trim().slice(0,-1),e=o[2].trim()):e+="\n"+i}),e&&createMarker(r,t,a,e)}function createMarker(r,n,e,t){var a=r.createMarker(n),i=t.toLowerCase().split(" ");a.name=e,a.comments=t;for(var o=colors.GREEN,s,f=0;f<i.length;f++)s=i[f],s==="cut"||s==="edit"?o=colors.RED:s==="fix"||s==="replace"?o=colors.ORANGE:s==="audio"||s==="sound"?o=colors.YELLOW:s=="reacted"&&(o=colors.PURPLE);a.setColorByIndex(o)}function exitErr(r){alert(r),exit(-1)}function updateEventPanel(r){app.setSDKEventMessage(r,"info")}function updateWithError(r){app.setSDKEventMessage(r,"error")}function addStringMethods(){typeof String.prototype.trim=="undefined"&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")})}function getFolderName(r){if(!r)return null;var n=r.getMediaPath(),e=n.lastIndexOf(sep);return e>-1?n.slice(0,e):n}function convertTimecodeToSeconds(r){var n=r.split(":");if(n.length!==3)return 0;var e=parseInt(n[0])*3600,t=parseInt(n[1])*60,a=parseInt(n[2]);if(isNaN(e)||isNaN(t)||isNaN(a))return 0;var i=e+t+a;return i}function readTextFile(r,n){var e=r instanceof File?r:new File(r);if(e.exists){e.open("r")||exitErr("Unable to open file "+decodeURI(e.name)),e.encoding||(e.encoding="UTF-8");var t=e.read();e.close();var a=t.split("\n");if(typeof n=="function")for(var i=0;i<a.length;i++)n(a[i],i);return t}else return!1}main();
