"use strict";addStringMethods();var project=app.project,sequence=project.activeSequence;sequence||exitErr("Script requires an active sequence!");var sequenceMarkers=sequence.markers,userPrompt="Select *.chat file";if(File.fs=="Windows")var chatFiles=File.openDialog(userPrompt,"CHAT Files: *.chat",!0);else var chatFiles=File.openDialog(userPrompt,checkMacFileType,!0);var colors={GREEN:0,RED:1,PURPLE:2,ORANGE:3,YELLOW:4,WHITE:5,BLUE:6,CYAN:7};function main(){var e=chatFiles.length;e||exitErr("No *.chat files selected!");for(var i=0;i<e;i++){var r=chatFiles[i];if(r instanceof File&&r.exists){var t=null,a,n;readTextFile(r,function(o){var s=o.split("	"),f=s[0].trim(),c=convertTimecodeToSeconds(f);s.length===3&&c?(t&&createMarker(a,n,t),a=c,n=s[1].trim().slice(0,-1),t=s[2].trim()):t+="\n"+o}),t&&createMarker(a,n,t)}}}function checkMacFileType(e){if(!(e instanceof Folder))return!0;var i=e.name.lastIndexOf("."),r=e.name.substring(i+1);return r=="chat"||r=="CHAT"}function createMarker(e,i,r){var t=sequenceMarkers.createMarker(e),a=r.toLowerCase().split(" ");t.name=i,t.comments=r;for(var n=colors.GREEN,o,s=0;s<a.length;s++)o=a[s],o==="cut"||o==="edit"?n=colors.RED:o==="fix"||o==="replace"?n=colors.ORANGE:o==="audio"||o==="sound"?n=colors.YELLOW:o=="reacted"&&(n=colors.PURPLE);t.setColorByIndex(n)}function exitErr(e){alert(e),exit(-1)}function updateEventPanel(e){app.setSDKEventMessage(e,"info")}function updateWithError(e){app.setSDKEventMessage(e,"error")}function addStringMethods(){typeof String.prototype.trim=="undefined"&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")})}function convertTimecodeToSeconds(e){var i=e.split(":");if(i.length!==3)return 0;var r=parseInt(i[0])*3600,t=parseInt(i[1])*60,a=parseInt(i[2]);if(isNaN(r)||isNaN(t)||isNaN(a))return 0;var n=r+t+a;return n}function readTextFile(e,i){var r=e instanceof File?e:new File(e);if(r.exists){r.open("r")||exitErr("Unable to open file "+decodeURI(r.name)),r.encoding||(r.encoding="UTF-8");var t=r.read();r.close();var a=t.split("\n");if(typeof i=="function")for(var n=0;n<a.length;n++)i(a[n],n);return t}else return!1}main();
