"use strict";addStringMethods();var project=app.project,userPrompt="Select *.chat file";if(File.fs=="Windows")var chatFiles=File.openDialog(userPrompt,"CHAT Files: *.chat",!0);else var chatFiles=File.openDialog(userPrompt,checkMacFileType,!0);var colors={GREEN:0,RED:1,PURPLE:2,ORANGE:3,YELLOW:4,WHITE:5,BLUE:6,CYAN:7};function main(){var t=chatFiles.length;t||exitErr("No *.chat files selected!");var n=project.rootItem.findItemsMatchingMediaPath(chatFiles[0].parent.fsName),e=n.length;e||exitErr("No media clips with the same media path as selected *chat file!");for(var a=0;a<t;a++){var r=chatFiles[a];if(r instanceof File&&r.exists)for(var i=0;i<e;i++)createClipMarkersFromChatFile(n[i].getMarkers(),r)}}function checkMacFileType(t){if(!(t instanceof Folder))return!0;var n=t.name.lastIndexOf("."),e=t.name.substring(n+1);return e=="chat"||e=="CHAT"}function createClipMarkersFromChatFile(t,n){var e=null,a,r;readTextFile(n,function(i){var o=i.split("	"),s=o[0].trim(),c=convertTimecodeToSeconds(s);o.length===3&&c?(e&&createMarker(t,a,r,e),a=c,r=o[1].trim().slice(0,-1),e=o[2].trim()):e+="\n"+i}),e&&createMarker(t,a,r,e)}function createMarker(t,n,e,a){var r=t.createMarker(n),i=a.toLowerCase().split(" ");r.name=e,r.comments=a;for(var o=colors.GREEN,s,c=0;c<i.length;c++)s=i[c],s==="cut"||s==="edit"?o=colors.RED:s==="fix"||s==="replace"?o=colors.ORANGE:s==="audio"||s==="sound"?o=colors.YELLOW:s=="reacted"&&(o=colors.PURPLE);r.setColorByIndex(o)}function exitErr(t){alert(t),exit(-1)}function updateEventPanel(t){app.setSDKEventMessage(t,"info")}function updateWithError(t){app.setSDKEventMessage(t,"error")}function addStringMethods(){typeof String.prototype.trim=="undefined"&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")})}function convertTimecodeToSeconds(t){var n=t.split(":");if(n.length!==3)return 0;var e=parseInt(n[0])*3600,a=parseInt(n[1])*60,r=parseInt(n[2]);if(isNaN(e)||isNaN(a)||isNaN(r))return 0;var i=e+a+r;return i}function readTextFile(t,n){var e=t instanceof File?t:new File(t);if(e.exists){e.open("r")||exitErr("Unable to open file "+decodeURI(e.name)),e.encoding||(e.encoding="UTF-8");var a=e.read();e.close();var r=a.split("\n");if(typeof n=="function")for(var i=0;i<r.length;i++)n(r[i],i);return a}else return!1}main();
