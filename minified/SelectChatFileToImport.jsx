"use strict";addStringMethods();var project=app.project,userPrompt="Select *.chat file",chatFiles;File.fs=="Windows"?chatFiles=File.openDialog(userPrompt,"CHAT Files: *.chat",!0):chatFiles=File.openDialog(userPrompt,checkMacFileType,!0);var colors={GREEN:0,RED:1,PURPLE:2,ORANGE:3,YELLOW:4,WHITE:5,BLUE:6,CYAN:7};function main(){var t=chatFiles.length;t||exitErr("No *.chat files selected!");var n=project.rootItem.findItemsMatchingMediaPath(chatFiles[0].parent.fsName),e=n.length;e||exitErr("No media clips with the same media path as selected *chat file!");for(var i=0;i<t;i++){var r=chatFiles[i];if(r instanceof File&&r.exists)for(var a=0;a<e;a++)createClipMarkersFromChatFile(n[a].getMarkers(),r)}}function checkMacFileType(t){if(!(t instanceof Folder))return!0;var n=t.name.lastIndexOf("."),e=t.name.substring(n+1);return e=="chat"||e=="CHAT"}function createClipMarkersFromChatFile(t,n){var e=null,i,r;readTextFile(n,function(a){var o=a.split("	"),s=o[0].trim(),c=convertTimecodeToSeconds(s);o.length===3&&c?(e&&createMarker(t,i,r,e),i=c,r=o[1].trim().slice(0,-1),e=o[2].trim()):e+="\n"+a}),e&&createMarker(t,i,r,e)}function createMarker(t,n,e,i){var r=t.createMarker(n),a=i.toLowerCase().split(" ");r.name=e,r.comments=i;for(var o=colors.GREEN,s,c=0;c<a.length;c++)s=a[c],s==="cut"||s==="edit"?o=colors.RED:s==="fix"||s==="replace"?o=colors.ORANGE:s==="audio"||s==="sound"?o=colors.YELLOW:s=="reacted"&&(o=colors.PURPLE);r.setColorByIndex(o)}function exitErr(t){alert(t),exit(-1)}function updateEventPanel(t){app.setSDKEventMessage(t,"info")}function updateWithError(t){app.setSDKEventMessage(t,"error")}function addStringMethods(){typeof String.prototype.trim=="undefined"&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")})}function convertTimecodeToSeconds(t){var n=t.split(":");if(n.length!==3)return 0;var e=parseInt(n[0])*3600,i=parseInt(n[1])*60,r=parseInt(n[2]);if(isNaN(e)||isNaN(i)||isNaN(r))return 0;var a=e+i+r;return a}function readTextFile(t,n){var e=t instanceof File?t:new File(t);if(e.exists){e.open("r")||exitErr("Unable to open file "+decodeURI(e.name)),e.encoding||(e.encoding="UTF-8");var i=e.read();e.close();var r=i.split("\n");if(typeof n=="function")for(var a=0;a<r.length;a++)n(r[a],a);return i}else return!1}main();
